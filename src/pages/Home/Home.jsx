import React, { useEffect, useRef, useState } from 'react';
import Navbar from '../../components/Navbar/Navbar';
const Home = () => {

  const [newNumber, setNewNumber] = useState('');
  const [newNumbers, setNewNumbers] = useState('');
  const [contacts, setContacts] = useState(    ["+919119279626","+917690986636","+919885997676","+919115148354","+917410873266","+919303778342","+919150092182","+918057366369","+918955954915","+919265821182","+919131408137","+919604076306","+919997982027","+919964926666","+919588375773","+919302727065","+916307298784","+919321087729","+917773855109","+917982133296","+917310652839","+916263841825","+919891827054","+917080074838","+919909238746","+919373067672","+917984545415","+919561117003","+919108326322","+918929158990","+918285287100","+919111046132","+919664742640","+917582080083","+917039033498","+918447277477","+919949490182","+919104965189","+919981225242","+919929525407","+919673081378","+919113975987","+919761650584","+919652070483","+919131546523","+918147544632","+919014828351","+919992203477","+918658991191","+919712158087","+917088313692","+917722068310","+919356524419","+919509975423","+919699464817","+919763919963","+918103803677","+919591613793","+919324294527","+919301865938","+917229974355","+918788823680","+919307615184","+918758370027","+918965874160","+917709715609","+917812822409","+917668964046","+919021218254","+918179489689","+919862166271","+919975631984","+919059875832","+919627322102","+918799292894","+918849044886","+917093523482","+918347453234","+919391294555","+919985390607","+919000387307","+919766240513","+917017240880","+919300005918","+918741994667","+918722985775","+919137809415","+919764546919","+918263973724","+917760341395","+919302112046","+919315108713","+919050705025","+919066683788","+916371560193","+917774970666","+916268478055","+919937219189","+919718140526","+917760119987","+917675924647","+918830952637","+919686506720","+919081781454","+919352443841","+917415551892","+917409521223","+917247401056","+919306156845","+918748943943","+919106323541","+918790757502","+917879289346","+919010501436","+916376961332","+918999574335","+918368703441","+919881554651","+916351416850","+917047091345","+916263327296","+919980012907","+919403195906","+918799685910","+918746864004","+919033450083","+919657549555","+919556714135","+917354081315","+919158566974","+919849949206","+916280760669","+917066203515","+919921999749","+918197657689","+917206676561","+918985938672","+919145454741","+917762971915","+919685039226","+919759003392","+919326023614","+919664277501","+916268203865","+919910093173","+916283663966","+918886860228","+919849755147","+919752709331","+917087045590","+919972619686","+918121876376","+919668078059","+918888941899","+917000398124","+917024907457","+918269990793","+918088880250","+919552845239","+917265090573","+919923666100","+919700262467","+916301949832","+919098533307","+918503854314","+918449892161","+917569769019","+917749096335","+917895431069","+919535417555","+916260523527","+919731372332","+917008585790","+917725090644","+918856925118","+918839422408","+919686768056","+917869031665","+919822754965","+919337666838","+919620072261","+918955100292","+919368230409","+919974067440","+919644876859","+916265191399","+917898727673","+916264737694","+919120715986","+917974928780","+919861865896","+919103331944","+917999592323","+919970460075","+918424882851","+919913036534","+917550386786","+919667046731","+919960938026","+919632019189","+917055418146","+918788302106","+919537515928","+919215559600","+919571509929","+917666568007","+916367038747","+919179421791","+919370569124","+919399004868","+919173650001","+919823147355","+919353028811","+917338348933","+919872460720","+918016100283","+919005525664","+918869889846","+918238474350","+916265017422","+919390778409","+919922457637","+918143121563","+917892457438","+917378792930","+919644504236","+919584353944","+916364642158","+918329930375","+917386009649","+917498668565","+917874586501","+918010240344","+919977249564","+919347101829","+919879850899","+919182367720","+917701956953","+918917469706","+919058812879","+919913095381","+919753451535","+919680282796","+918223911355","+917741878143","+919568170192","+919726249026","+916364072112","+919518524243","+918767562561","+919114415591","+919340147731","+916371789348","+918200321611","+919824426565","+917869131934","+919370914310","+918329706106","+917488004478","+917330840496","+916265491541","+917000199710","+917987723544","+918074322643","+919399109780","+919853482838","+919804041049","+919552243576","+919705618052","+918317594904","+917799110297","+919505806395","+919052237751","+917058141933","+918073557642","+919629167056","+916397948355","+919449790722","+917483461041","+917219353253","+919664338811","+917906766361","+918959206591","+919079305762","+917980420763","+918305656566","+919425839879","+918085362374","+917610413642","+919723073994","+919960588295","+918319477215","+919724717316","+918287315282","+917709734695","+918144190320","+918109696213","+918769330813","+919027437423","+918910220366","+919535669606"]
);
  const textareaRef = useRef(null);
  const [newMessage, setNewMessage] = useState('');
  const [message, setMessage] = useState('This is current test message, update it below with your message');

  const ContactBox = ({ contact }) => (
    <div style={{ border: '1px solid gray', padding: '10px', margin: '10px', display:"flex", justifyContent:"space-between", alignItems:"center", borderRadius:"15px"}}>
      <h3>{contact}</h3>
      <a target='_blank' rel="noreferrer" href={`https://api.whatsapp.com/send?phone=${encodeURIComponent(contact)}&text=${encodeURIComponent(message)}`}><svg style={{width:"2.5rem"}} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 175.216 175.552"><defs><linearGradient id="b" x1="85.915" x2="86.535" y1="32.567" y2="137.092" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#57d163"/><stop offset="1" stop-color="#23b33a"/></linearGradient><filter id="a" width="1.115" height="1.114" x="-.057" y="-.057" color-interpolation-filters="sRGB"><feGaussianBlur stdDeviation="3.531"/></filter></defs><path fill="#b3b3b3" d="m54.532 138.45 2.235 1.324c9.387 5.571 20.15 8.518 31.126 8.523h.023c33.707 0 61.139-27.426 61.153-61.135.006-16.335-6.349-31.696-17.895-43.251A60.75 60.75 0 0 0 87.94 25.983c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.312-6.179 22.558zm-40.811 23.544L24.16 123.88c-6.438-11.154-9.825-23.808-9.821-36.772.017-40.556 33.021-73.55 73.578-73.55 19.681.01 38.154 7.669 52.047 21.572s21.537 32.383 21.53 52.037c-.018 40.553-33.027 73.553-73.578 73.553h-.032c-12.313-.005-24.412-3.094-35.159-8.954zm0 0" filter="url(#a)"/><path fill="#fff" d="m12.966 161.238 10.439-38.114a73.42 73.42 0 0 1-9.821-36.772c.017-40.556 33.021-73.55 73.578-73.55 19.681.01 38.154 7.669 52.047 21.572s21.537 32.383 21.53 52.037c-.018 40.553-33.027 73.553-73.578 73.553h-.032c-12.313-.005-24.412-3.094-35.159-8.954z"/><path fill="url(#linearGradient1780)" d="M87.184 25.227c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.312-6.179 22.559 23.146-6.069 2.235 1.324c9.387 5.571 20.15 8.518 31.126 8.524h.023c33.707 0 61.14-27.426 61.153-61.135a60.75 60.75 0 0 0-17.895-43.251 60.75 60.75 0 0 0-43.235-17.929z"/><path fill="url(#b)" d="M87.184 25.227c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.313-6.179 22.558 23.146-6.069 2.235 1.324c9.387 5.571 20.15 8.517 31.126 8.523h.023c33.707 0 61.14-27.426 61.153-61.135a60.75 60.75 0 0 0-17.895-43.251 60.75 60.75 0 0 0-43.235-17.928z"/><path fill="#fff" fill-rule="evenodd" d="M68.772 55.603c-1.378-3.061-2.828-3.123-4.137-3.176l-3.524-.043c-1.226 0-3.218.46-4.902 2.3s-6.435 6.287-6.435 15.332 6.588 17.785 7.506 19.013 12.718 20.381 31.405 27.75c15.529 6.124 18.689 4.906 22.061 4.6s10.877-4.447 12.408-8.74 1.532-7.971 1.073-8.74-1.685-1.226-3.525-2.146-10.877-5.367-12.562-5.981-2.91-.919-4.137.921-4.746 5.979-5.819 7.206-2.144 1.381-3.984.462-7.76-2.861-14.784-9.124c-5.465-4.873-9.154-10.891-10.228-12.73s-.114-2.835.808-3.751c.825-.824 1.838-2.147 2.759-3.22s1.224-1.84 1.836-3.065.307-2.301-.153-3.22-4.032-10.011-5.666-13.647"/></svg></a>
    </div>
  );

  const changeMessage = (e) => {
    e.preventDefault();
    setMessage(newMessage);
    setNewMessage('')
  }

  const handleAddSingleNumber = (e) => {
    e.preventDefault()
    if (newNumber.trim().length == 10) {
      setContacts([...contacts, { number: `+91${newNumber}` }]);
      setNewNumber('');
    } else {
      window.alert(`Number ${newNumber} is not a valid Indian mobile number`)
    }
  };

  const handleAddMultipleNumber = (e) => {
    e.preventDefault()
    const regex = /^[6-9]\d{9}$/
    let errorfulNumbers = [];
    const numbersArray = newNumbers
      .split(/[\n,]+/) // Split on line breaks and commas
      .map(num => num.trim()) // Remove leading/trailing whitespace
      .map((num, index) => {
        num = num.trim()
        if (!(num.length === 10 && regex.test(num))) {
          window.alert(`Number ${index + 1} is not a valid Indian mobile number: ${num}`)
          errorfulNumbers.push(num)
          return null;
        } else {
          return num;
        }
      }) // Show error for unformatted numbers 
      .filter(num => num != null && num.length == 10 && num.match(regex)); // Remove unformatted numbers
    
    const newContactsArray = numbersArray.map(num => ({ number: num }));
    setContacts([...contacts, ...newContactsArray]);
    
    if(errorfulNumbers.length > 0) {
      setNewNumbers(errorfulNumbers.join('\n'))
      window.alert("Correct the invalid numbers in input and add again")
    } else {
      setNewNumbers('');
    }

  };

  useEffect(() => {
    const textArea = textareaRef.current;
    if(textArea) {
      textArea.rows = Math.max(1, textArea.value.split('\n').length) > 5 ? 5 : Math.max(1, textArea.value.split('\n').length)
    }
  },[newNumbers])

  return (
    <>
    <Navbar/>
    <br></br>
    <div style={{padding:"0 0.75rem"}}>
    <h2>Current Message : </h2>
    <p style={{wordWrap:'break-word'}}>{message}</p>
    </div>
    <form className="d-flex" role="search" style={{padding:"0 0.75rem"}} onSubmit={(e) => changeMessage(e)}>
        <input className="form-control me-2" placeholder="New message here" value={newMessage} onChange={(e) => setNewMessage(e.target.value)}/>
        <button className="btn btn-outline-success" type="submit">Change</button>
      </form>
      <br></br>
      <br></br>
      <div style={{padding:"0 0.75rem 0.75rem 0.75rem"}}>
    <h2>Add Numbers (Indian only) : </h2>
    <div>Note :</div>
    <div>1. Add number without country code</div>
    <div>2. For multiple numbers separate with comma or enter</div>
    </div>
    <form className="d-flex" role="search" style={{padding:"0 0.75rem"}} onSubmit={(e) => handleAddSingleNumber(e)}>
        <input className="form-control me-2" type='number' maxLength={10} placeholder="Add single number here" value={newNumber} onChange={(e) => setNewNumber(e.target.value)}/>
        <button style={{padding:"0 1.55rem"}} className="btn btn-outline-success" type="submit">Add</button>
      </form>
      <p></p>
      <form className="d-flex" role="search" style={{padding:"0 0.75rem"}} onSubmit={(e) => handleAddMultipleNumber(e)}>
        <textarea ref={textareaRef} className="form-control me-2" rows={1} placeholder="Add multiple number here" value={newNumbers} onChange={(e) => setNewNumbers(e.target.value)}/>
        <button style={{padding:"0 1.55rem"}} className="btn btn-outline-success" type="submit">Add</button>
      </form>
      <br></br>
      <br></br>
      <h2 style={{padding:"0 0.75rem"}}>Contact List :</h2>
      {contacts.length <= 0 ? <p style={{padding:"0 0.75rem"}}>Add numbers above to send message</p> : <p style={{padding:"0 0.75rem"}}>Refresh the page to remove all</p>}
     {contacts.map(contact => (
      <ContactBox key={contact} contact={contact} />
    ))}
    </>
  );
};

export default Home;